# dva

> 官网：https://dvajs.com

1. 不仅仅是一个第三方库，更是一个框架

2. 主要整合了 redux 的相关内容，处理数据的能力有了质的飞跃

3. 依赖项：react、react-router、redux、redux-saga、react-redux、connect-react-router 等

![dva概念](react-learn\assets\img\dva.png)

## dva 使用

1. dva 默认导出一个函数，通过调用该函数，可以得到一个 dva 对象

2. dva 对象.router：路由方法，传入一个函数，该函数会返回一个 React 节点，应用程序启动后，会自动渲染该节点

3. dva 对象.start：该方法用于启动 dva 应用程序，可以认为启动的就是 react 程序，该函数传入一个**选择器**，用于选中页面中的某个 dom 元素，react 会将内容渲染到该元素内部

4. dva 对象.model：该方法用于定义一个模型，该模型可以理解为 redux 的 action、reducer、redux-saga 副作用的整合，整合成一个对象，该对象传入 model 方法即可

   1. **namespace**：命名空间，必须

   2. **state**：该模型的默认状态，必须

   3. **reducers**：该属性配置为一个对象，对象中的每个方法就是一个 reducer，dva 约定方法的名字就是匹配的 action 类型

   4. **effects**：处理副作用，底层是使用 redux-saga 实现的，该属性配置为一个对象，对象中的每个方法处理一个副作用，方法的名字就是匹配的 action 类型

      1. 参数 1：action

      2. 参数 2：封装好的 saga/effects 对象

   5. **subscriptions**：配置为一个对象，该对象中可以任意名称的属性，每个属性就是一个函数，这些函数会在模型加入到仓库中立即执行

5. 在 dva 中同步路由到仓库

   1. 调用 dva 函数时，配置 history 对象

   2. 使用 ConnectedRouter 提供路由上下文

6. 配置：

   1. history：同步到仓库的 history 对象

   2. initialState：创建 redux 仓库时，使用的默认状态

   3. onError：当仓库的运行发生错误，运行的函数

   4. onAction：可以配置 redux 中间件

      1. 传入一个中间件对象

      2. 传入一个中间件数组

   5. onStateChange：当仓库中的状态发生变化时，运行的函数

   6. onReducer：对模型中的 reducer 的进一步封装

   7. onEffect：对模型中的 effect 的进一步封装

   8. extraReducers：用于配置额外的 reducer，是一个对象，对象的每一个属性是一个方法，每个方法就是一个需要合并的 reducer，方法名即属性名

   9. extraEnhancers：用于封装 createStore 函数，dva 会将原来的仓库创建函数作为参数传递，返回一个新的用于创建仓库的函数，**函数必须放到数组中**

### 注意事项

1. reducer、effect 同名，匹配后都会处理，reducer 先处理

2. 在启动前定义模型

3. onAction 相当于是 redux 中间件

4. onEffect，参数为 oldEffect、sagaEffect、model、actionType

5. 合并：从右向左，从后往前；调用：从左向右，从前往后

6. routerRedux：包含了 connected-react-router 库

7. 模型一定要声明命名空间和设置默认值

8. 模型外部需要加上前缀，使用本模型中的不需要前缀，使用其它模型的需要加上前缀
