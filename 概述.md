# redux-saga

> 中文文档地址：https://redux-saga-in-chinese.js.org/

## 特点

1. 纯净

2. 强大

3. 灵活

## 基础

1. 在 saga 任务中，如果 yield 了一个普通函数，saga 不作任何处理，仅仅是将数据传递给 yield 表达式（把得到的数据放大 next 的参数中），因此，在 saga 中，yield 一个普通数据没有任何意义

2. saga 需要在 yield 后面放上一些合适的 saga 指令（saga effects），如果放的是指令，saga 中间件会根据不同的指令进行特殊处理，以控制整个任务的流程

3. 每个指令本质上就是一个函数，该函数调用后，会返回一个指令对象，saga 会收到该指令对象，进行各种处理

4. 一旦 saga 任务完成（生成器函数运行完毕）， 则 saga 中间件一定会结束

## 指令

- take 指令：【阻塞】监听某个 action，如果 action 发生了，则会进行下一步的处理，take 指令只会监听一次，yield 得到的是完整的 action 对象

- all 指令：【阻塞】该函数传入一个数组，数组中放入生成器，saga 会等待所有的生成器函数完成后才会进行下一步的处理

- takeEvery：不断地监听某个 action，当某个 action 到达之后，运行一个函数。takeEvery 永远不会结束当前的生成器

- delay 指令：【阻塞】阻塞指定的毫秒数

- put 指令：用于重新触发 action，相当于 dispatch 一个 action

- call 指令：【可能阻塞】用于副作用（通常是异步）函数调用

- apply 指令：【可能阻塞】用于副作用（通常是异步）函数调用

- select 指令：用于得到当前仓库中的数据

- cps 指令：【可能阻塞】用于调用那些传统的回调方式的异步函数

- fork 指令：用于开启一个新任务，该任务不会阻塞，该函数需要传递一个生成器函数，fork 返回了一个对象，类型为 Task

- cancel 指令：用于取消一个或多个任务，实际上，取消的原理是利用 generator.return。cancel 可以不传递参数，如果不传递参数，则取消当前任务线

- takeLastest 指令：功能和 takeEvery 一致，不同的是，会自动取消之前开启的任务

- cancelled 指令：判断当前任务线是否被取消掉了

- race：【阻塞】竞赛，可以传递多个指令，当其中任何一个指令结束后，会直接结束。与 promise.race 类似，返回的结果是最先完成的指令结果。并且，该函数会自动取消其它的任务

```js
function takeEvery(actionTypes, saga) {
  return fork(function* () {
    while (true) {
      const action = yield take(actionType);
      fork(saga);
    }
  });
}
```
